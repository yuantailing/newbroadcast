{% extends "base.html" %}
{% block body %}
<input type="hidden" id="result-pid" value="{{ pid }}" />
<p>这里显示搜索结果</p>
<p>搜索结果的ID从$('#result-pid')中获取</p>
<p>暂时没有实现搜索算法，搜索结果是所有节目的ID</p>
	<table id="search-result" class="table table-striped table-hover">
		<tbody id="result-tbody"></tbody>
	</table>
{% endblock %}
{% block script %}
	<script>
	var search="";
	var pids = new Array();
		$(document).ready(function() {
			pids=$('#result-pid').attr("value");
			pids = eval("("+pids+")");
			showSearch();
/*			var url=document.location.href;
			var arrStr=url.substring(url.indexOf("?")+1).split("&");
			for (var i=0;i<arrStr.length;i++) {
				var loc=arrStr[i].indexOf("search=");
				if (loc!=-1) {
					search=arrStr[i].replace("search=", "").replace("?","");
				}
			}
			alert(search);
			getSearch();
*/
		});
/*		function getSearch() {
			$.ajax({
				url:'',
				type:"POST",
				data:{'search':search},
					dataType:"json"
			}).done(function(msg){
				pids = msg.pid;
			}).fail(function(jqXHR,textStatus){
			});
		}
*/
		function showSearch() {
			$.ajax({
			  url:'/resource/getarr/',
			  type:"POST",
			  data:{'pid':pids},
				dataType:"json"
			}).done(function(msg){
				document.getElementById("result-tbody").innerHTML="";
				for (var i=0;i<pids.length;i++) {
					var tr=document.createElement("tr");
					document.getElementById("result-tbody").appendChild(tr);
					var td1=document.createElement("td");
					tr.appendChild(td1);
					var a=document.createElement("a");
					a.href="/program/"+pids[i];
					a.innerHTML=msg.program[i].title;
					td1.appendChild(a);
					var td2=document.createElement("td");
					td2.innerHTML=msg.program[i].group+"/"+msg.program[i].series;
					tr.appendChild(td2);
				}
			}).fail(function(jqXHR, textStatus){
			});
		}
	</script>
{% endblock %}