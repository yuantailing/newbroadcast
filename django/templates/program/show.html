{% extends "base.html" %}
{% block title %}{{ title }} - 清华大学广播站{% endblock %}
{% block body %}
<div class="container">
	<hr class="featurette-divider" />
	<div class="row featurette jumbotron">
		<div class="col-md-8">	
	      <h1 class="featurette-heading">{{ title }}</h1>
	      <p class="lead"><big><strong>{{ strong }}</strong></big>{{ description }}</p>
	    </div>
	    <div class="col-md-1"></div>
	    <div class="col-md-3">
	      <div class="row">
	        <div style="float:right">
		        {% if medialink %}
		        <a class="btn btn-primary" href="/program/play/{{ pgid }}" target="_blank" role="button"><span class="glyphicon glyphicon-play"></span>播放</a>
				{% if logined %}
		        <a class="btn btn-primary" href="{{ medialink }}" target="_blank" role="button"><span class="glyphicon glyphicon-save"></span>下载</a>
				{% else %}
		        <a class="btn btn-primary disabled" role="button"><span class="glyphicon glyphicon-save"></span>下载</a>
				{% endif %}
		        {% else %}
		        <a class="btn btn-primary disabled" role="button"><span class="glyphicon glyphicon-play"></span>播放</a>
		        <a class="btn btn-primary disabled" role="button"><span class="glyphicon glyphicon-save"></span>下载</a>
		        {% endif %}
	        </div>
	      </div>
	      <div class="row">
	      	<br />
	      	<div style="float:right">
				{% if logined %}
	      		{% if have_praised %}
		      	<a class="btn btn-primary" id="program-praise" role="button" style="color:red" praised="true"><span id="program-praise-count" class="glyphicon glyphicon-thumbs-up">{{ praise_count}}</span></a>
		      	{% else %}
		      	<a class="btn btn-primary" id="program-praise" role="button" praised="false"><span id="program-praise-count" class="glyphicon glyphicon-thumbs-up">{{praise_count}}</span></a>
		      	{% endif %}
				{% else %}
				<a class="btn btn-primary disabled" id="program-praise" role="button"><span id="program-praise-count" class="glyphicon glyphicon-thumbs-up">{{ praise_count}}</span></a>
		      	{% endif %}
		        <a class="btn btn-primary" href="#program-add-comment-div" role="button"><span class="glyphicon glyphicon-comment"></span></a>
		        <a class="btn btn-primary" role="button"><span class="glyphicon glyphicon-heart"></span></a>
		        <a class="btn btn-primary" role="button"><span class="glyphicon glyphicon-share"></span></a>
	        </div>
	      </div>
	      <div class="row">
	          <br />
	          <div style="float:right">
		          {% for src in piclink %}
				  <div class="row">
				    <img src="{{ src }}" class="img-rounded img-responsive center-block" />
				  </div>
				  <br />
				  {% endfor %}
			  </div>
	      </div>
	    </div>
	</div>
	<hr class="featurette-divider" />
	<div class="row featurette">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h4>详细信息</h4>
			</div>
			<table class="table table-striped table-hover">
		    {% for a in table %}
		    <tr>
		      <td>{{ a.0 }}</td>
		      <td>{{ a.1 }}</td>
		    </tr>
		    {% endfor %}
		    {% for d in doc_links %}
		    <tr>
		      <td>{{ d.0 }}</td>
		      <td><a href="{{ d.1 }}" target="_blank">{{ d.2 }}</a></td>
		    </tr>
		    {% endfor %}
			</table>
		</div>
	</div>
	<hr class="featurette-divider" />
	<div class="row featurette" id="program-comment">
		<div class="panel panel-default">
			<div class="panel-heading">
				<h4>评论</h4>
			</div>
			<table class="table table-striped table-hover">
			{% for cm in comments %}
				<tr>
					<td>{{ cm.content }}</td>
					<td>{{ cm.user.nickname }}</td>
				</tr><!-- Todo: 确定评论的显示样式 -->
			{% endfor %}
			</table>
			{% if logined %}
			<hr />
			<div id="program-add-comment-div">
				<div style="position:relative;left:1%;">
					<button class="btn btn-primary" id="add-comment">发表评论</button>
				</div>
				<div style="position:relative;margin:1%">
					<textarea style="width:100%;border-color:#ddd;border-radius:5px;" rows="5"></textarea>
				</div>
			</div>
			<!-- Todo: 将评论内容以GET或POST方式发送到program/comment/add/，参数（键）为comment、pid -->
			{% endif %}
		</div>
	</div>
</div>
<div class="col-md-2"></div>


  
  <hr/>
  
{% endblock %}

{% block script %}
<script>
$('#program-praise').click(function() {
	var praise_button = $('#program-praise');
	if (praise_button.attr("praised") == "true") { 
		$.ajax({
	        url:'/program/unpraise/',
	        type:"POST",
	        data:{pid: {{ pgid }} },
	        dataType:"json"
	    }).done(function(msg){
	        if (msg.success) {
	        	praise_button.css("color", "#fff");
	        	praise_button.attr("praised", "false");
	        	$('#program-praise-count').html(msg.count);
	        }
	    }).fail(function(jqXHR,textStatus){
	        $('#change-info-status').html('与服务器连接中断');
	    });
    } else { 
    	$.ajax({
	        url:'/program/praise/',
	        type:"POST",
	        data:{pid: {{ pgid }} },
	        dataType:"json"
	    }).done(function(msg){
	        if (msg.success) {
	        	praise_button.css("color", "#f00");
	        	praise_button.attr("praised", "true");
	        	$('#program-praise-count').html(msg.count);
	        }
	    }).fail(function(jqXHR,textStatus){
	        $('#change-info-status').html('与服务器连接中断');
	    });
    }
});
</script>
{% endblock %}
