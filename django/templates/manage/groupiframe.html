{% extends "base-frame.html" %}
{% block body %}
<div class="panel panel-default">
	<div class="panel-heading">
		<h4>{{ title }}管理</h4>
	</div>
	<table class="panel-body table table-bordered table-striped table-hover">
		<div>
		</div>
		<thead>
		<tr>
		<th>标题</th>
		<th>节目数量</th>
		<th>创建时间</th>
		<th>修改操作</th>
		<th>删除操作</th>
		</tr>
		</thead>
		{% for pg in obj_list %}
		<tr>
		<td><a href="/source/?gid={{ pg.id }}" target="_parent">{{ pg.title }}</a></td>
		<td>{{ pg.program.count }}</a></td>
		<td>{{ pg.create_time|date:"Y-m-d" }}</a></td>
		<td><button class="btn btn-primary" data-toggle="modal" data-target="#change-info"
			onclick="$('#modal-modify-id').attr('value', '{{ pg.id }}'); $('#modal-modify-origin-name').html('{{ pg.title|addslashes }}');">修改</button></td>
		<td><button class="btn btn-primary" data-toggle="modal" data-target="#delete-info"
			onclick="$('#modal-delete-id').attr('value', '{{ pg.id }}'); $('#modal-delete-origin-name').html('{{ pg.title|addslashes }}');">删除</button></td>
		</tr>
		{% endfor %}
	</table>
</div>


<div class="modal fade" id="change-info" tabindex="-1" role="dialog" aria-labelledby="change-password-label" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">
            <button type="button" class="close" 
               data-dismiss="modal" aria-hidden="true">
                  &times;
            </button>
            <h4 class="modal-title">
               修改{{ obj_title }}
            </h4>
            <div id="change-password-status"></div>
         </div>
         <div class="modal-body">
            <form class="form-horizontal" role="form">
				<span id="modal-modify-status"></span>
				<input type="hidden" class="form-control" id="modal-modify-id"/>
				<div class="form-group">
					<label for="old-password" class="col-sm-offset-1 col-sm-2 control-label">旧名称</label>
					<div class="col-sm-6">
						<span id="modal-modify-origin-name">旧名称</span>
					</div>
				</div>
				<div class="form-group">
					<label for="new-password" class="col-sm-offset-1 col-sm-2 control-label">新名称</label>
					<div class="col-sm-6">
						<input type="text" class="form-control" id="modal-modify-new-name" placeholder="请输入新组名" />
					</div>
				</div>
			</form>
         </div>
         <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="modal-modify-button">
              	提交
            </button>
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
         </div>
      </div><!-- /.modal-content -->
    </div>
</div><!-- /.modal -->

<div class="modal fade" id="delete-info" tabindex="-1" role="dialog" aria-labelledby="change-password-label" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">
            <button type="button" class="close" 
               data-dismiss="modal" aria-hidden="true">
                  &times;
            </button>
            <h4 class="modal-title">
               删除{{ obj_title }}
            </h4>
            <div id="change-password-status"></div>
         </div>
         <div class="modal-body">
            <form class="form-horizontal" role="form">
				<span id="modal-delete-status"></span>
				<input type="hidden" class="form-control" id="modal-delete-id"/>
				<div class="form-group">
					<label for="old-password" class="col-sm-offset-1 col-sm-2 control-label">名称</label>
					<div class="col-sm-6">
						<span id="modal-delete-origin-name">名称</span>
					</div>
				</div>
			</form>
         </div>
         <div class="modal-footer">
            <button type="button" class="btn btn-primary" id="modal-delete-button">
              	确认删除
            </button>
            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
         </div>
      </div><!-- /.modal-content -->
    </div>
</div><!-- /.modal -->


{% endblock %}
{% block script %}
<script>
$('#modal-modify-button').click(function() {
	$.ajax({
		url:'/manage/groupseries/{{ obj_type }}/',
		type:"POST",
		data:{action:'modify', id:$('#modal-modify-id').val(), new_name:$('#modal-modify-new-name').val() },
		dataType:"json"
	}).done(function(msg){
		$('#modal-modify-status').html(msg.info);
		if (msg.success)
			location.reload();
	}).fail(function(jqXHR,textStatus){
		$('#modal-modify-status').html('与服务器连接中断');
	});
});

$('#modal-delete-button').click(function() {
	$.ajax({
		url:'/manage/groupseries/{{ obj_type }}/',
		type:"POST",
		data:{action:'delete', id:$('#modal-delete-id').val(), },
		dataType:"json"
	}).done(function(msg){
		$('#modal-delete-status').html(msg.info);
		if (msg.success)
			location.reload();
	}).fail(function(jqXHR,textStatus){
		$('#modal-delete-status').html('与服务器连接中断');
	});
});
</script>
{% endblock %}